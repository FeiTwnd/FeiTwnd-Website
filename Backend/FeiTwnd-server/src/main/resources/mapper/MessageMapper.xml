<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cc.feitwnd.mapper.MessageMapper">

    <insert id="save" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO messages
            (content, content_html, root_id, parent_id, parent_nickname, visitor_id, 
             nickname, email_or_qq, location, user_agent_os, user_agent_browser,
             is_approved, is_markdown, is_secret, is_notice, is_edited, is_admin_reply,
             create_time, update_time)
        VALUES
            (#{content}, #{contentHtml}, #{rootId}, #{parentId}, #{parentNickname}, #{visitorId},
             #{nickname}, #{emailOrQq}, #{location}, #{userAgentOs}, #{userAgentBrowser},
             #{isApproved}, #{isMarkdown}, #{isSecret}, #{isNotice}, #{isEdited}, #{isAdminReply},
             #{createTime}, #{updateTime})
    </insert>

    <select id="pageQuery" resultType="cc.feitwnd.entity.Messages">
        SELECT * FROM messages
        <where>
            <if test="isApproved != null">
                AND is_approved = #{isApproved}
            </if>
            <if test="startTime != null">
                AND create_time &gt;= #{startTime}
            </if>
            <if test="endTime != null">
                AND create_time &lt;= #{endTime}
            </if>
        </where>
        ORDER BY create_time DESC
    </select>

    <select id="getById" resultType="cc.feitwnd.entity.Messages">
        SELECT * FROM messages WHERE id = #{id}
    </select>

    <update id="batchApprove">
        UPDATE messages
        SET is_approved = 1, update_time = NOW()
        WHERE id IN
        <foreach collection="list" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </update>

    <delete id="batchDelete">
        DELETE FROM messages
        WHERE id IN
        <foreach collection="list" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

</mapper>
